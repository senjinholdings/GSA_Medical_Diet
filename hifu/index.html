<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NR2WZVQX');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025年全国版｜おすすめ比較ランキング</title>
    <!-- Vercel deployment: 2025-07-21 23:40 -->
    <!-- Map modal feature added: 2024-01-29 15:30 -->
    <meta name="description" content="あなたの地域の優良クリニックを探そう。地域別ランキング、診療科目、営業時間から最適な医療機関を見つけられます。">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <!-- 重要なリソースのpreload -->
    <link rel="preload" as="image" href="images/OMT_MV.webp" fetchpriority="high" type="image/webp">
    <link rel="preload" as="style" href="styles.css?v=2025080101">
    <link rel="preload" as="script" href="app.js?v=2025081417">
    <!-- Google Fontsはプリロードせず、通常のロードのみにする -->
    <!-- スタイルシート -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="styles.css?v=2025081417" media="all">
    <link rel="icon" type="image/png" href="../common_data/images/favicon.png" id="favicon">
    <!-- Critical CSS -->
    <!-- Font loading detection -->
    <script>'fonts' in document&&document.fonts.ready.then(function(){document.documentElement.classList.add('fonts-loaded')})</script>
    
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NR2WZVQX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="container">
        <!-- ヘッダー -->
        <header class="site-header">
            <div class="header-content">
                <div class="logo-section">
                    <a href="/" class="logo-link">
                        <div class="logo-main">
                            <span class="logo-icon"><img src="../common_data/images/favicon.png" alt="矯正歯科おすすめ比較.com" id="header-logo-icon"></span>
                            <h1 class="site-logo" id="site-logo">おすすめ比較.com</h1>
                        </div>
                    </a>
                </div>
                <nav class="header-nav">
                    <button class="hamburger-menu" id="hamburger-menu" aria-label="メニュー">
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                </nav>
            </div>
        </header>

        <!-- メインビジュアル -->
        <section class="hero-section">
            <div class="hero-image-wrapper">
                <picture>
                    <source srcset="images/OMT_MV.webp" type="image/webp">
                    <img src="images/mv.webp" alt="2025年最新版" class="hero-image" loading="eager" fetchpriority="high" decoding="async" width="1500" height="928">
                </picture>
                <div id="mv-region-name" style="position:absolute;top: 8%;left: 1%;width: clamp(60px, 15vw, 115px);text-align: center;color: #808080;font-size: clamp(14px, 3.5vw, 27px);font-weight: 600;z-index:10;pointer-events:none;padding: clamp(4px, 1vw, 8px);border-radius: 8px;">東京</div>
                <div id="mv-left-appeal-text" style="position:absolute;top: 26%;left: 12%;;text-align: center;color: #808080;font-size: clamp(14px, 3.2vw, 25px);font-weight: 700;z-index:10;pointer-events:none;padding: clamp(6px, 1.5vw, 12px);"></div>
                <svg id="mv-main-svg-text" style="position:absolute;top: 35%;left:39%;transform:translateX(-50%);z-index:10;pointer-events:none;overflow: visible;width: 60vw;height: 10vh;">
                    <text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" fill="#ff94ae" stroke="white" stroke-width="6px" paint-order="stroke" style="font-size: clamp(14px, 6vw, 48px);font-weight: 700;">
                        
                    </text>
                </svg>
                <svg id="mv-appeal1-text" style="position:absolute;top: 52%;left:39%;transform:translateX(-50%);z-index:10;pointer-events:none;overflow: visible;width: 60vw;height: 10vh;">
                    <text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" fill="#ff94ae" stroke="white" stroke-width="6px" paint-order="stroke" style="font-size: clamp(14px, 8vw, 62px); font-weight: 700;">
                    </text>
                </svg>
            </div>
            <div style="text-align: right; padding: 5px 20px; color: #808080; font-size: 10px; font-weight: normal; max-width: 768px; margin: 0 auto;">PR</div>
        </section>

        <main>

            <!-- ランキング表示セクション -->
            <section class="clinic-rankings">
                <div class="ranking-header-banner">
                    <img src="images/ranking_header_banner.webp" alt="" class="ranking-banner-image">                    
                </div>
                <div id="rank-region-name" style="position:absolute;top: 6%;left: 52%;white-space: nowrap;transform: translateX(-50%);text-align: center;color: rgb(255, 255, 255);font-size: clamp(14px, 4.8vw, 33px);font-weight: 600;z-index:10;pointer-events:none;">東京</div>
                <div id="ranking-list" class="ranking-container">
                    <!-- ランキングはJavaScriptで動的に生成 -->
                </div>
            </section>

            <!-- ランキング表示セクション下の注意事項 -->
            <section id="ranking-disclaimers-section" class="disclaimers-section" style="padding: 0px 10px; background: #ffffff;">
                <div class="container" style="max-width: 768px; margin: 0 auto;">
                    <!-- 注意事項アコーディオン -->
                    <div class="disclaimer-accordion" style="margin-top: 15px;">
                        <!-- 第1段階: 各クリニックの注意事項 -->
                        <div class="main-disclaimer">
                            <button id="ranking-disclaimer-button" class="main-disclaimer-header ranking-disclaimer-header" style="width: 100%; text-align: left; padding: 8px 12px; background-color: #ffffff; border: 1px solid #f0f0f0; border-radius: 3px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="font-size: 10px; font-weight: 500; color: #666;">各クリニックの注意事項</span>
                                <span id="ranking-main-arrow" style="font-size: 8px; color: rgb(153, 153, 153); transition: transform 0.2s; transform: rotate(0deg);">▼</span>
                            </button>
                            <div id="ranking-disclaimers-content" class="main-disclaimer-content" style="display: none; padding: 5px; background-color: rgb(252, 252, 252); border-right: 1px solid rgb(240, 240, 240); border-bottom: 1px solid rgb(240, 240, 240); border-left: 1px solid rgb(240, 240, 240); border-image: initial; border-top: none; border-radius: 0px 0px 3px 3px; margin-top: -5px;">
                                <!-- 動的に生成される注釈コンテンツ -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ユーザーの悩みを解消するためのTips -->
            <div class="container tips-container" style="max-width: 768px; margin: 20px auto; padding: 0 10px; position: relative;">
                <div class="tips-section" style="width: 100%;">
                    <div style="display: flex; flex-direction: column;">
                        <!-- タブナビゲーション -->
                        <div class="tabs" style="display: flex; gap: 5px; margin-bottom: 0;">
                            <div class="tab active" data-tab="0" style="flex: 1; background-color: #2CC7C5; color: white; padding: 10px 15px; text-align: center; cursor: pointer; border-radius: 4px 4px 0 0; font-weight: 600; transition: all 0.3s ease; font-size: 14px; display: flex; align-items: center; justify-content: center;">
                                <span class="tab-text">効果</span>
                            </div>
                            <div class="tab" data-tab="1" style="flex: 1; background-color: #F1F1F1; color: #4C4C4C; padding: 10px 15px; text-align: center; cursor: pointer; border-radius: 4px 4px 0 0; font-weight: 600; transition: all 0.3s ease; font-size: 14px; display: flex; align-items: center; justify-content: center;">
                                <span class="tab-text">選び方</span>
                            </div>
                            <div class="tab" data-tab="2" style="flex: 1; background-color: #F1F1F1; color: #4C4C4C; padding: 10px 15px; text-align: center; cursor: pointer; border-radius: 4px 4px 0 0; font-weight: 600; transition: all 0.3s ease; font-size: 14px; display: flex; align-items: center; justify-content: center;">
                                <span class="tab-text">おすすめ</span>
                            </div>
                        </div>

                        <!-- タブコンテンツコンテナ -->
                        <div class="tab-contents" style="position: relative; background-color: #FFFFFF; border: 1px solid #E0E0E0; border-radius: 0 0 4px 4px; padding: 15px;">
                            <!-- タブ1: マウスピース矯正の効果 -->
                            <div class="tab-content active" data-tab="0" style="display: block;">
                                <div style="width: 100%; margin-bottom: 15px;">
                                    <img src="images/Tips1.webp" alt="効果" style="width: 100%; height: auto; border-radius: 4px;" loading="lazy">
                                </div>
                                <p style="font-size: 14px; line-height: 1.8; color: #4C4C4C; margin-bottom: 15px;">
                                    
                                </p>
                            </div>

                            <!-- タブ2: クリニック選び -->
                            <div class="tab-content" data-tab="1" style="display: none;">
                                <div style="width: 100%; margin-bottom: 15px;">
                                    <img src="images/Tips2.webp" alt="ポイント" style="width: 100%; height: auto; border-radius: 4px;" loading="lazy">
                                </div>
                                <p style="font-size: 14px; line-height: 1.8; color: #4C4C4C; margin-bottom: 15px;">
                                   
                                </p>
                            </div>

                            <!-- タブ3: 今がおすすめ -->
                            <div class="tab-content" data-tab="2" style="display: none;">
                                <div style="width: 100%; margin-bottom: 15px;">
                                    <img src="images/Tips3.webp" alt="今がおすすめの理由" style="width: 100%; height: auto; border-radius: 4px;" loading="lazy">
                                </div>
                                <p style="font-size: 14px; line-height: 1.8; color: #4C4C4C; margin-bottom: 15px;">
                                    
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                // Tips section tab functionality
                (function() {
                    const tabs = document.querySelectorAll('.tips-container .tab');
                    const tabContents = document.querySelectorAll('.tips-container .tab-content');

                    function updateTabs(index) {
                        // Update tabs
                        tabs.forEach((tab, i) => {
                            if (i === index) {
                                tab.classList.add('active');
                                tab.style.backgroundColor = '#2B5797';
                                tab.style.color = 'white';
                            } else {
                                tab.classList.remove('active');
                                tab.style.backgroundColor = '#CCCCCC';
                                tab.style.color = '#333';
                            }
                        });
                        
                        // Update tab contents
                        tabContents.forEach((content, i) => {
                            if (i === index) {
                                content.style.display = 'block';
                            } else {
                                content.style.display = 'none';
                            }
                        });
                    }

                    // Tab click handlers
                    tabs.forEach((tab, index) => {
                        tab.addEventListener('click', () => updateTabs(index));
                    });
                })();
            </script>
        
        <script>
        // 詳細情報を表示する関数
        function showDisclaimerInfo(type) {
            const modal = document.getElementById('disclaimer-modal');
            const modalBody = document.getElementById('disclaimer-modal-body');
            
            const disclaimers = {
                'dio-success-rate': {
                    title: '',
                    content: ''
                }
            };
            
            const info = disclaimers[type];
            if (info) {
                modalBody.innerHTML = `
                    <h3 style="margin-top: 0; color: #333;">${info.title}</h3>
                    <p style="font-size: 14px; line-height: 1.6; color: #666;">${info.content}</p>
                `;
                modal.style.display = 'block';
            }
        }
        
        // モーダルを閉じる関数
        function closeDisclaimerInfo() {
            document.getElementById('disclaimer-modal').style.display = 'none';
        }
        
        // モーダルの外側をクリックしたら閉じる
        window.onclick = function(event) {
            const modal = document.getElementById('disclaimer-modal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        </script>

            <!-- 比較表セクション -->
            <section class="comparison-section">
                <div class="comparison-header">
                    <h2 class="comparison-title"><span id="comparison-region-name"></span></h2>
                    <h3 class="comparison-subtitle"><span class="accent-text"></span></h3>
                </div>
                
                <div class="comparison-table" id="comparison-tab-menu" data-active-tab="tab1">
                    <div class="comparison-tab-menu">
                        <div class="comparison-tab-menu-item tab-active" data-tab="tab1">総合</div>
                        <div class="comparison-tab-menu-item" data-tab="tab2">施術内容</div>
                        <div class="comparison-tab-menu-item" data-tab="tab3">サービス</div>
                    </div>
                    <table id="comparison-table">
                        <thead>
                            <tr id="comparison-header-row">
                                <!-- Headers will be dynamically generated from site-common-texts.json -->
                                <th></th>
                                <th class="" style=""></th>
                                <th class="" style=""></th>
                                <th class="" style=""></th>
                                <th></th>
                                <th class="th-none" style="display: none;"></th>
                                <th class="th-none" style="display: none;"></th>
                                <th class="th-none" style="display: none;"></th>
                                <th class="th-none" style="display: none;"></th>
                                <th class="th-none" style="display: none;"></th>
                                <th class="th-none" style="display: none;"></th>
                                <th class="th-none" style="display: none;"></th>
                            </tr>
                        </thead>
                        <tbody id="comparison-tbody">
                            <!-- 動的に生成される比較表の内容がここに表示されます -->
                        </tbody>
                    </table>
                    <!-- 注意事項アコーディオン -->
                    <div class="disclaimer-accordion" style="margin-top: 15px;">
                        <!-- 第1段階: 各クリニックの注意事項 -->
                        <div class="main-disclaimer">
                            <button id="comparison-disclaimer-button" class="main-disclaimer-header comparison-disclaimer-header" style="width: 100%; text-align: left; padding: 8px 12px; background-color: #fafafa; border: 1px solid #f0f0f0; border-radius: 3px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="font-size: 10px; font-weight: 500; color: #666;">各クリニックの注意事項</span>
                                <span id="main-arrow" style="font-size: 8px; color: rgb(153, 153, 153); transition: transform 0.2s; transform: rotate(0deg);">▼</span>
                            </button>
                            <div id="main-content" class="main-disclaimer-content" style="display: none; padding: 5px; background-color: rgb(252, 252, 252); border-right: 1px solid rgb(240, 240, 240); border-bottom: 1px solid rgb(240, 240, 240); border-left: 1px solid rgb(240, 240, 240); border-image: initial; border-top: none; border-radius: 0px 0px 3px 3px; margin-top: -5px;">
                                <!-- 動的に生成される注釈コンテンツ -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 案件詳細セクション -->
            <section class="clinic-details-section">
                <div class="details-header-banner">
                    <img src="images/details_header_bannar3.webp" alt="コスパ×効果×通いやすさで選ぶ医療痩身クリニックBEST3" class="details-banner-image">
                    <div id="detail-region-name">人気のおすすめクリニック</div>
                    <div id="detail-rank-best">3<span style="font-size: 0.6em;"> 選！</span></div>
                </div>
                
                <div id="clinic-details-list" class="clinic-details-container">
                    <!-- 詳細コンテンツはJavaScriptで動的に生成 -->
                </div>
            </section>

            <!-- 医療情報コラムセクション -->
            <section class="medical-columns-section">
                <div class="columns-container">
                    <!-- Main Article Card -->
                    <div class="article-card">
                        <div class="article-header">
                            <div class="article-title">
                                ポテンツァ施術前に知っておくべきこと
                            </div>
                            <div class="header-image">
                                <img src="images/column.webp" alt="ポテンツァ施術の基礎知識" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </div>

                        <!-- Table of Contents -->
                        <div class="toc-section">
                            <div class="toc-title">目次</div>
                            <ul class="toc-list">
                                <li class="toc-item">
                                    <a href="#comparison" class="toc-link">ポテンツァとは</a>
                                    <div class="toc-sub-item">
                                        <a href="#mechanism" class="toc-link">施術の仕組み</a>
                                    </div>
                                    <div class="toc-sub-item">
                                        <a href="#merits" class="toc-link">メリット・デメリット</a>
                                    </div>
                                </li>
                                <li class="toc-item">
                                    <a href="#risks" class="toc-link">ポテンツァのリスクや副作用</a>
                                    <div class="toc-sub-item">
                                        <a href="#side-effects" class="toc-link">起こりうる副作用</a>
                                    </div>
                                    <div class="toc-sub-item">
                                        <a href="#pain" class="toc-link">痛みやダウンタイムについて</a>
                                    </div>
                                    <div class="toc-sub-item">
                                        <a href="#precautions" class="toc-link">施術前・施術後の注意点</a>
                                    </div>
                                </li>
                                <li class="toc-item">
                                    <a href="#contract" class="toc-link">施術時の確認ポイント</a>
                                    <div class="toc-sub-item">
                                        <a href="#insurance" class="toc-link">保険適用について</a>
                                    </div>
                                    <div class="toc-sub-item">
                                        <a href="#details" class="toc-link">施術内容・計画を細かく確認</a>
                                    </div>
                                    <div class="toc-sub-item">
                                        <a href="#additional-fees" class="toc-link">追加費用がかからないか確認</a>
                                    </div>
                                    <div class="toc-sub-item">
                                        <a href="#troubles" class="toc-link">トラブル時の相談先</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Comparison: Mouthpiece vs Wire Orthodontics -->
                    <div class="article-card">
                        <div class="content-section" id="comparison">
                            <div class="section-title">ポテンツァとは</div>
                            <div class="section-content">
                                ポテンツァは<span style="background-color: #fff3cd; padding: 2px 4px;">高周波（RF）による美肌治療</span>の一種で、マイクロニードルで皮膚に微細な穴を開け、高周波エネルギーを真皮層に届ける施術です。ニキビ跡、毛穴、肌質改善、シワ、たるみの改善に効果的です。
                            </div>

                            <table class="tips-comparison-table">
                                <thead class="table-header">
                                    <tr>
                                        <th>特徴</th>
                                        <th>内容</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="table-row">
                                        <td class="row-header">施術方法</td>
                                        <td>マイクロニードル + 高周波エネルギー</td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="row-header">適応部位</td>
                                        <td>顔全体、首、デコルテなど</td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="row-header">効果</td>
                                        <td>ニキビ跡、毛穴改善、肌質向上</td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="row-header">ダウンタイム</td>
                                        <td>数日〜1週間程度</td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="row-header">施術時間</td>
                                        <td>30分〜1時間程度</td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="row-header">費用相場</td>
                                        <td>5万〜15万円（部位による）</td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="row-header">持続性</td>
                                        <td>3〜6ヶ月程度（定期的な施術が必要）</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="section-content">
                                <small>（※）回数・期間は目安です。個人差や症例による違いがあります。上記は効果を保証するものではありません。</small>
                            </div>

                            <div class="section-content" style="margin-top: 16px;">
                                ポテンツァは、マイクロニードルで皮膚に微細な穴を開け、高周波エネルギーを真皮層に届けることで、コラーゲンの生成を促進し、肌質を改善する施術です。ニキビ跡や毛穴の開きが気になる方に特におすすめです。施術時間も比較的短く、日常生活への影響を最小限に抑えながら効果的に肌質を向上させることができます。
                            </div>
                        </div>
                    </div>

                    <!-- Mechanism Section -->
                    <div class="article-card">
                        <div class="highlight-box" id="mechanism">
                            <div class="section-title">ポテンツァの施術の仕組み</div>
                            <div class="section-content">
                                ポテンツァは<span style="background-color: #fff3cd; padding: 2px 4px;">マイクロニードルで皮膚に微細な穴を開け</span>、高周波（RF）エネルギーを真皮層まで届けることで、コラーゲンの生成を促進します。熱エネルギーによるアプローチが特徴です。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                高周波エネルギーにより<span style="background-color: #fff3cd; padding: 2px 4px;">真皮層の細胞が活性化され、コラーゲンやエラスチンの生成が促進</span>されます。肌のハリや弾力が向上し、ニキビ跡や毛穴の改善効果が得られます。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                切開を行わず、マイクロニードルの微細な穴で完了するため、身体への負担が少なく、日常生活への影響も最小限に抑えられます。
                            </div>
                        </div>
                    </div>

                    <!-- Merits and Demerits -->
                    <div class="article-card">
                        <div class="highlight-box" id="merits">
                            <div class="section-title">ポテンツァのメリット・デメリット</div>
                            <div class="section-content">
                                ポテンツァの特徴を理解し、自分に合った施術かどうかを判断する参考にしてください。
                            </div>

                            <table class="merit-table">
                                <thead>
                                    <tr>
                                        <th class="merit-header">分類</th>
                                        <th class="merit-header">内容</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="merit-category">メリット</td>
                                        <td class="merit-content">
                                            <ul>
                                                <li>マイクロニードルで肌質改善が可能</li>
                                                <li>ニキビ跡、毛穴、シワの改善効果</li>
                                                <li>ダウンタイムが比較的短い</li>
                                                <li>日常生活への影響が最小限</li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="merit-category">デメリット</td>
                                        <td class="merit-content">
                                            <ul>
                                                <li>複数回の施術が必要な場合がある</li>
                                                <li>効果の実感まで時間がかかる場合がある</li>
                                                <li>施術時の軽い痛みや赤みのリスク</li>
                                                <li>定期的なメンテナンスが必要</li>
                                            </ul>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Risks and Side Effects -->
                    <div class="article-card">
                        <div class="content-section" id="risks">
                            <div class="section-title">ポテンツァのリスクや副作用</div>
                            <div class="header-image" style="margin: 16px 0;">
                                <img src="images/column2.webp" alt="ポテンツァの副作用について" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy">
                            </div>
                            <div class="section-content">
                                ポテンツァはマイクロニードルによる施術のため、施術直後の赤み、腫れ、軽い痛みや熱感などの副作用が生じることがあります。施術後は保湿ケアが必要な場合もあります。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                施術による副作用は一時的で軽度なものがほとんどです。気になる症状があれば、必ず担当医に相談しましょう。
                            </div>
                        </div>
                    </div>

                    <!-- Side Effects Detail -->
                    <div class="article-card">
                        <div class="highlight-box" id="side-effects">
                            <div class="section-title">起こりうる副作用</div>
                            <div class="section-content">
                                ポテンツァで起こりうる主な副作用は以下の通りです。
                            </div>

                            <div class="subsection-title">施術時の痛みや熱感</div>
                            <div class="section-content">
                                マイクロニードルによる軽い痛みや高周波による熱感が生じることがあります。麻酔クリームを使用することで痛みを軽減できます。通常は施術終了後すぐに治まります。
                            </div>

                            <div class="subsection-title">赤み・腫れ</div>
                            <div class="section-content">
                                施術部位に赤みや軽度の腫れが生じることがあります。通常は数日〜1週間程度で自然に治まります。
                            </div>

                            <div class="subsection-title">皮むけ・かさつき</div>
                            <div class="section-content">
                                高周波の熱により、皮むけや肌のかさつきが生じることがあります。保湿ケアをしっかり行いましょう。
                            </div>

                            <div class="subsection-title">効果の発現時期</div>
                            <div class="section-content">
                                効果が現れるまで個人差があります。施術後数週間〜数ヶ月程度で効果を実感できる場合が多いです。
                            </div>
                        </div>
                    </div>

                    <!-- Pain Information -->
                    <div class="article-card">
                        <div class="highlight-box" id="pain">
                            <div class="section-title">痛みやダウンタイムについて</div>
                            <div class="section-content">
                                ポテンツァの施術後の痛みやダウンタイムは、<span style="background-color: #fff3cd; padding: 2px 4px;">マイクロニードルによる軽い痛みと高周波による熱感、その後の赤み・腫れが主な症状</span>で、個人差があります。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                一般的にダウンタイムを感じやすい時期は以下の通りです。
                            </div>

                            <div class="pain-area-box">
                                <div class="pain-area">施術直後〜数日間</div>
                                <div class="pain-area">赤み・腫れが最も強い時期</div>
                                <div class="pain-area">保湿ケアが必要な期間</div>
                            </div>

                            <div class="section-content">
                                痛みや腫れが強い場合、または長引く場合は、担当医に相談しましょう。適切なケアと指示に従うことで、快適に回復できます。
                            </div>
                        </div>
                    </div>

                    <!-- Precautions Before and During Treatment -->
                    <div class="article-card">
                        <div class="highlight-box" id="precautions">
                            <div class="section-title">施術前・施術後の注意点</div>
                            <div class="section-content">
                                ポテンツァの効果を最大限に引き出すため、以下の点に注意しましょう。
                            </div>

                            <div class="subsection-title">施術前の準備</div>
                            <div class="section-content">
                                施術前に十分なカウンセリングを受け、適応かどうか確認しましょう。日焼けを避け、抗凝固薬の使用については医師に相談してください。
                            </div>

                            <div class="subsection-title">施術後のケア</div>
                            <div class="section-content">
                                施術部位を清潔に保ち、保湿ケアをしっかり行いましょう。日焼けを避け、指示されたスキンケアを行ってください。
                            </div>

                            <div class="subsection-title">経過観察</div>
                            <div class="section-content">
                                施術後の経過を観察し、指示されたスケジュールでクリニックに通いましょう。
                            </div>

                            <div class="subsection-title">生活習慣の管理</div>
                            <div class="section-content">
                                施術前後は飲酒や激しい運動を避け、十分な休息を取ってください。体調が優れない場合は担当医に相談しましょう。
                            </div>
                        </div>
                    </div>

                    <!-- Contract Considerations -->
                    <div class="article-card">
                        <div class="content-section" id="contract">
                            <div class="section-title">施術時の確認ポイント</div>
                            <div class="header-image" style="margin: 16px 0;">
                                <img src="images/column3.webp" alt="ポテンツァ施術の注意点" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy">
                            </div>
                        </div>
                    </div>

                    <!-- Insurance Coverage -->
                    <div class="article-card">
                        <div class="highlight-box" id="insurance">
                            <div class="section-title">保険適用について</div>
                            <div class="section-content">
                                ポテンツァは高周波による美肌治療の一種で、美容目的の施術となるため、原則として自由診療（自費診療）となります。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                健康保険が適用されるのは、機能障害がある場合に限られます。通常の美肌目的の場合は自費となります。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                <span style="background-color: #fff3cd; padding: 2px 4px;">原則自費負担</span>のため、施術前に総額や追加費用を確認しましょう。
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Service Confirmation -->
                    <div class="article-card">
                        <div class="highlight-box" id="details">
                            <div class="section-title">施術内容・計画を細かく確認する</div>
                            <div class="section-content">
                                ポテンツァを契約する際は、施術計画・範囲・効果の期待値などを具体的に確認しましょう。自分の目標や希望に合っているかが重要です。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                例えば「ニキビ跡の改善」と言っても、施術回数や使用するチップの種類、施術間隔などがクリニックによって異なります。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                施術後に計画が変更となる場合、追加料金が発生することもあるため、<span style="background-color: #fff3cd; padding: 2px 4px;">施術前に施術内容をしっかり確認</span>しておきましょう。
                            </div>
                        </div>
                    </div>

                    <!-- Additional Fees -->
                    <div class="article-card">
                        <div class="highlight-box" id="additional-fees">
                            <div class="section-title">追加費用がかからないか確認する</div>
                            <div class="section-content">
                                施術時には、追加の費用についても必ず確認しましょう。提示料金とは別に、追加施術・薬剤代・経過観察費用などが発生する場合があります。
                            </div>
                            <div class="section-content" style="margin-top: 12px;">
                                追加費用が掛かる項目の例は以下の通りです。
                            </div>

                            <ul class="fee-list">
                                <li class="fee-item">追加施術費用</li>
                                <li class="fee-item">チップ追加代</li>
                                <li class="fee-item">経過観察費用</li>
                                <li class="fee-item">保湿剤材料費</li>
                                <li class="fee-item">アフターケア費用</li>
                            </ul>

                            <div class="section-content">
                                追加費用については、施術前に必ず確認するようにしてください。
                            </div>
                        </div>
                    </div>

                    <!-- Troubleshooting -->
                    <div class="article-card">
                        <div class="highlight-box" id="troubles">
                            <div class="section-title">トラブル時の相談先</div>
                            <div class="section-content">
                                万が一、ポテンツァ施術についてトラブルになった場合は、以下の窓口に相談できます。
                            </div>

                            <ul class="contact-list">
                                <li class="contact-item">
                                    <i class="fas fa-phone"></i>
                                    <a href="https://www.anzen-shien.jp/center/" target="_blank" rel="noopener noreferrer" class="contact-link" style="position: relative; z-index: 10; display: inline-block;">医療安全支援センター（医療に関する苦情・心配事の相談）</a>
                                </li>
                                <li class="contact-item">
                                    <i class="fas fa-phone"></i>
                                    <a href="https://www.caa.go.jp/policies/policy/local_cooperation/local_consumer_administration/hotline/" target="_blank" rel="noopener noreferrer" class="contact-link" style="position: relative; z-index: 10; display: inline-block;">消費者ホットライン（施術内容や契約条件など、契約に関する相談）</a>
                                </li>
                                <li class="contact-item">
                                    <i class="fas fa-phone"></i>
                                    <a href="https://www.caa.go.jp/policies/policy/local_cooperation/local_consumer_administration/hotline/" target="_blank" rel="noopener noreferrer" class="contact-link" style="position: relative; z-index: 10; display: inline-block;">医療相談窓口（医療に関する広告についての相談）</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>



   <!-- 迷ったら1位クリニックセクション -->
            <div id="first-choice-recommendation-section">
                <div style="position: relative; display: inline-block; width: 100%;">
                    <img src="images/ranking_header_banner.webp" alt="" class="ranking-banner-image">
                    <div id="first-choice-region-text" style="position: absolute;bottom: 44%;left: 6%;text-align: center;color: rgb(255, 255, 255);font-size: clamp(16px, 5vw, 38px);font-weight: 600;z-index: 10;pointer-events: none;">迷ったら<span id="first-choice-clinic-name"></span>がおすすめ</div>
                </div><section class="first-choice-recommendation-section" style="border: 5px solid rgb(253 208 124);border-radius: -5px;padding: 5px 5px 10px 5px;margin: 0px 20px;background-color: #fffef8;">
                                
            
            <!-- バナー -->
            <div class="first-choice-banner" style="text-align: center;/* margin-bottom: 30px; */">
                <img id="first-choice-banner-image" src="" alt="" style="max-width: 100%; height: auto;">
            </div>
            
            <!-- クリニックがおすすめの3つの理由 -->
            <div class="section-title" style="
margin: 2%;
text-align: center;
">
                <h3><span id="first-choice-title-clinic-name"></span>がおすすめの<span style="color: #2CC7C5;">3つの理由</span></h3>
            </div>
            
            <!-- ポイント -->
            <div class="ribbon_point_box_no" id="first-choice-points">
                
                    <div class="ribbon_point_title2_s">
                        <i class="fas fa-clock point-icon-inline"></i>
                        <strong id="point1-title"></strong>
                    </div>
                    <div class="ribbon_point_txt">
                        <p id="point1-description" style="font-size:14px;"></p>
                    </div>
                    
                    <div class="ribbon_point_title2_s">
                        <i class="fas fa-clock point-icon-inline"></i>
                        <strong id="point2-title"></strong>
                    </div>
                    <div class="ribbon_point_txt">
                        <p id="point2-description" style="font-size:14px;"></p>
                    </div>
                    
                    <div class="ribbon_point_title2_s">
                        <i class="fas fa-clock point-icon-inline"></i>
                        <strong id="point3-title"></strong>
                    </div>
                    <div class="ribbon_point_txt">
                        <p id="point3-description" style="font-size:14px;"></p>
                    </div>
                    
                <div class="ribbon_point_link" id="first-choice-official-link">
                    【公式】<a href="https://www.xn--ecki4eoz3204ct89aepry34c.com/draft/go/dio/?max_scroll=100&amp;region_id=013" target="_blank" rel="noopener"><strong></strong></a>
                </div>
            </div>
            
            <!-- Information -->
            <div class="campaign-container">
                <div class="campaign-header">INFORMATION!</div>
                <div class="campaign-content">
                    <div class="camp_header3">
                        <div class="info_logo">
                            <img id="first-choice-info-logo" src="" alt="">
                        </div>
                        <div class="camp_txt" id="first-choice-campaign-text">
                        </div>
                    </div>
                    
                    <div class="cv_box_img">
                        <span id="first-choice-achievement-text"></span>
                        <p class="btn btn_second_primary" style="margin-top: 10px;">
                            <a id="first-choice-cta-link" href="https://www.xn--ecki4eoz3204ct89aepry34c.com/draft/go/dio/?max_scroll=100&amp;region_id=013" target="_blank" rel="noopener">
                                <span class="bt_s" id="first-choice-cta-text"></span>
                                <span class="btn-arrow">▶</span>
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- ディオクリニックの確認事項アコーディオン -->
            <div class="disclaimer-accordion" style="margin-top: 15px;">
                <button class="disclaimer-header" onclick="toggleDisclaimer('dio-campaign-first-choice')" style="width: 100%; text-align: left; padding: 8px 12px; background-color: #fafafa; border: 1px solid #f0f0f0; border-radius: 3px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    <span id="first-choice-disclaimer-title" style="font-size: 10px; font-weight: 500; color: #666;"></span>
                    <span id="dio-campaign-first-choice-arrow" style="font-size: 8px; color: rgb(153, 153, 153); transition: transform 0.2s;">▼</span>
                </button>
                <div id="dio-campaign-first-choice-content" class="disclaimer-content" style="display: none; padding: 8px 12px; background-color: rgb(252, 252, 252); border-right: 1px solid rgb(240, 240, 240); border-bottom: 1px solid rgb(240, 240, 240); border-left: 1px solid rgb(240, 240, 240); border-image: initial; border-top: none; border-radius: 0px 0px 3px 3px; margin-top: -1px;">
                    <div style="font-size: 9px; color: #777; line-height: 1.4;">
                        
                    </div>
                </div>
            </div>
        </section>
            </div>

        </main>

        <!-- 詳細情報モーダル -->
        <div id="disclaimer-modal" class="disclaimer-modal" style="display: none;">
            <div class="disclaimer-modal-content">
                <span class="disclaimer-modal-close" onclick="closeDisclaimerInfo()">&times;</span>
                <div id="disclaimer-modal-body"></div>
            </div>
        </div>

        <!-- フッター -->
        <div id="footer">
            <div class="footer_contents">
                <h4><a href="/">矯正歯科おすすめ比較.com</a></h4>
                
                <ul>
                    <h5>人気クリニック</h5>
                    <li><a href="#clinic1">Oh my teeth</a></li>
                    <li><a href="#clinic2">インビザライン</a></li>
                    <li><a href="#clinic3">キレイライン矯正</a></li>
                </ul>
                                
                <ul>
                    <h5>運営</h5>
                    <li><a href="/common_page/company/" class="footer-page-link">運営者情報</a></li>
                    <li><a href="/common_page/privacy/" class="footer-page-link">プライバシーポリシー</a></li>
                    <li><a href="/common_page/disclaimer/" class="footer-page-link">免責事項</a></li>
                    <li><a href="mailto:clinic.hikaku.review@gmail.com">お問い合わせ</a></li>
                </ul>
                
            </div>
            
            <div class="footer-bottom">
                <p class="copyright">© 2025 矯正歯科おすすめ比較.com</div></p>
                <p class="disclaimer">※本サイトの情報は参考程度に留め、必ず歯科医院にご相談ください。</p>
            </div>
        </div>

        <!-- サイドバーメニュー -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        <div class="sidebar-menu" id="sidebar-menu">
            <div class="sidebar-header">
                <h3 class="sidebar-title">絞り込み検索</h3>
                <button class="close-sidebar" id="close-sidebar" aria-label="閉じる">×</button>
            </div>
            <div class="sidebar-content">
                <div class="sidebar-filter-group">
                    <label for="sidebar-region-select" class="sidebar-filter-label">地域選択</label>
                    <select id="sidebar-region-select" class="sidebar-select">
                        <!-- 地域オプションはJavaScriptで動的に生成 -->
                    </select>
                </div>
                <div class="sidebar-filter-group">
                    <label for="sidebar-clinic-search" class="sidebar-filter-label">クリニック名検索</label>
                    <input type="text" id="sidebar-clinic-search" class="sidebar-search-input" placeholder="クリニック名を入力">
                </div>
                <div class="sidebar-filter-group">
                    <label for="sidebar-specialty-filter" class="sidebar-filter-label">対応部位</label>
                    <select id="sidebar-specialty-filter" class="sidebar-select">
                        <option value="">すべての部位</option>
                        <option value="face">顔</option>
                        <option value="upperarm">二の腕</option>
                        <option value="stomach">お腹</option>
                        <option value="buttocks">お尻</option>
                        <option value="thigh">太もも</option>
                        <option value="other">その他</option>
                    </select>
                </div>
                <div class="sidebar-filter-group">
                    <label for="sidebar-hours-filter" class="sidebar-filter-label">店舗数</label>
                    <select id="sidebar-hours-filter" class="sidebar-select">
                        <option value="">店舗数指定なし</option>
                        <option value="small">0〜5店舗</option>
                        <option value="medium">6〜10店舗</option>
                        <option value="large">10〜20店舗</option>
                        <option value="xlarge">それ以上</option>
                    </select>
                </div>
                <div class="sidebar-search-button">
                    <a href="./search-results.html" class="sidebar-search-link">詳細検索ページへ</a>
                </div>
            </div>
        </div>

        <div id="error-message" class="error-message" style="display: none;">
            <p id="error-text"></p>
        </div>
        
        <!-- 地図モーダル -->
        <div id="map-modal" class="map-modal" style="display: none;">
            <div class="map-modal-overlay"></div>
            <div class="map-modal-content">
                <div class="map-modal-header">
                    <h3 class="map-modal-title" id="map-modal-clinic-name">クリニック名</h3>
                    <button class="map-modal-close" id="map-modal-close" aria-label="閉じる">&times;</button>
                </div>
                <div class="map-modal-body">
                    <div class="map-modal-map" id="map-modal-map-container">
                        <!-- Google Maps iframe will be inserted here -->
                    </div>
                    <table class="map-modal-info-table">
                        <tbody>
                            <tr>
                                <th>住所</th>
                                <td id="map-modal-address"></td>
                            </tr>
                            <tr>
                                <th>アクセス</th>
                                <td id="map-modal-access"></td>
                            </tr>
                            <tr>
                                <th>営業時間</th>
                                <td id="map-modal-hours">11:00〜21:00</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="map-modal-footer">
                        <p class="btn btn_second_primary" style="margin-top: 20px;">
                            <a id="map-modal-button" href="#" target="_blank" rel="noopener">
                                <span class="bt_s" id="map-modal-button-text">公式サイトから申し込む</span>
                                <span class="btn-arrow">▶</span>
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Slick Carousel JS -->
    <!-- Slick.js削除済み -->
    <script src="app.js?v=2025081417" defer></script>
    

    <!-- 1位クリニック動的表示機能 -->
    <script>
        // リダイレクトリンクのクリックハンドラー
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a');
            if (link && link.href) {
                console.log('Link clicked:', link.href);

                // redirect.htmlへのリンクの場合
                if (link.href.includes('/redirect.html')) {
                    e.preventDefault(); // デフォルトのリンク動作を阻止

                    // URLからパラメータを抽出
                    const url = new URL(link.href);
                    const hashParams = url.hash ? url.hash.substring(1) : '';

                    if (hashParams.startsWith('params=')) {
                        try {
                            const paramsJson = decodeURIComponent(hashParams.substring(7));
                            const params = JSON.parse(paramsJson);

                            // 現在のページのパラメータも追加保存
                            const currentUrl = new URL(window.location.href);
                            const originalParams = {};
                            for (const [key, value] of currentUrl.searchParams) {
                                originalParams[key] = value;
                            }

                            // paramsに元URLパラメータを追加
                            params.original_params = originalParams;

                            console.log('💾 保存するパラメータ:', params);

                            // localStorageに保存
                            localStorage.setItem('redirectParams', JSON.stringify(params));
                            console.log('Saved redirect params to localStorage:', params);

                            // redirect.htmlに移動
                            window.open(link.href, '_blank', 'noopener');
                        } catch (error) {
                            console.error('Failed to save redirect params:', error);
                        }
                    } else {
                        // ハッシュパラメータがない場合はURLパラメータから取得
                        const clinicId = url.searchParams.get('clinic_id');
                        const rank = url.searchParams.get('rank');
                        const regionId = url.searchParams.get('region_id');

                        if (clinicId) {
                            const params = { clinic_id: clinicId, rank: rank || 1, region_id: regionId || '013' };

                            // 現在のページのパラメータも追加保存
                            const currentUrl = new URL(window.location.href);
                            const originalParams = {};
                            for (const [key, value] of currentUrl.searchParams) {
                                originalParams[key] = value;
                            }
                            params.original_params = originalParams;

                            localStorage.setItem('redirectParams', JSON.stringify(params));
                            console.log('Saved fallback params to localStorage:', params);

                            // redirect.htmlに移動
                            window.open(link.href, '_blank', 'noopener');
                        }
                    }
                }
            }
        });
        
        // ランキングセクション用のアコーディオン関数（グローバルスコープに移動）
        window.toggleRankingDisclaimer = function(event) {
            console.log('>>> toggleRankingDisclaimer called');

            // イベント伝播を防ぐ
            if (event) {
                event.stopPropagation();
                event.preventDefault();
                event.stopImmediatePropagation();
            }

            // イベントターゲットがランキングセクション内かどうかをチェック
            if (event && event.target) {
                const isRankingSection = event.target.closest('.ranking-disclaimer-header') ||
                                        event.target.closest('#ranking-disclaimers-content') ||
                                        event.target.id === 'ranking-main-arrow';
                if (!isRankingSection) {
                    console.log('>>> Event target is not in ranking section, ignoring');
                    return false;
                }
            }

            const content = document.getElementById('ranking-disclaimers-content');
            const arrow = document.getElementById('ranking-main-arrow');

            if (content) {
                const currentDisplay = window.getComputedStyle(content).display;
                console.log('>>> Ranking current display:', currentDisplay);

                if (content.style.display === 'none' || currentDisplay === 'none') {
                    content.style.display = 'block';
                    if (arrow) arrow.style.transform = 'rotate(180deg)';
                    console.log('>>> Opened ranking disclaimer');
                } else {
                    content.style.display = 'none';
                    if (arrow) arrow.style.transform = 'rotate(0deg)';
                    console.log('>>> Closed ranking disclaimer');
                }
            } else {
                console.error('>>> Ranking disclaimer content not found!');
            }

            return false;
        }

                // 比較表セクション用のアコーディオン関数（第一段階）
        window.toggleComparisonDisclaimer = function(eventOrSlug) {
            console.log('>>> toggleComparisonDisclaimer called with:', eventOrSlug);

            // 引数がイベントオブジェクトの場合（第一段階）
            if (eventOrSlug && typeof eventOrSlug === 'object' && eventOrSlug.target) {
                const event = eventOrSlug;
                // イベント伝播を防ぐ
                if (event) {
                    event.stopPropagation();
                    event.preventDefault();
                    event.stopImmediatePropagation();
                }

                const content = document.getElementById('main-content');
                const arrow = document.getElementById('main-arrow');

                if (content) {
                    const currentDisplay = window.getComputedStyle(content).display;
                    if (content.style.display === 'none' || currentDisplay === 'none') {
                        content.style.display = 'block';
                        if (arrow) arrow.style.transform = 'rotate(180deg)';
                    } else {
                        content.style.display = 'none';
                        if (arrow) arrow.style.transform = 'rotate(0deg)';
                    }
                }
                return false;
            }
        }

        // 各クリニック個別のアコーディオン用の汎用関数
        function toggleClinicDisclaimer(uniqueSlug, event) {
            console.log('>>> toggleClinicDisclaimer called for:', uniqueSlug);
            if (event) {
                event.stopPropagation();
                event.preventDefault();
                event.stopImmediatePropagation();
            }

            const content = document.getElementById(`${uniqueSlug}-content`);
            const arrow = document.getElementById(`${uniqueSlug}-arrow`);

            if (content && arrow) {
                const currentDisplay = window.getComputedStyle(content).display;
                if (currentDisplay === 'none' || content.style.display === 'none') {
                    content.style.display = 'block';
                    if (arrow) arrow.style.transform = 'rotate(180deg)';
                } else {
                    content.style.display = 'none';
                    if (arrow) arrow.style.transform = 'rotate(0deg)';
                }
            } else {
                console.error('>>> disclaimer content/arrow not found for:', uniqueSlug);
            }
            return false;
        }
        
        // 元のtoggleDisclaimer関数（キャンペーンセクション用）
        function toggleDisclaimer(clinicSlug) {
            console.log('>>> toggleDisclaimer called with clinicSlug:', clinicSlug);
            
            const content = document.getElementById(`${clinicSlug}-content`);
            const arrow = document.getElementById(`${clinicSlug}-arrow`);
            
            console.log('>>> Found content element:', !!content);
            console.log('>>> Found arrow element:', !!arrow);
            
            if (content) {
                // 計算されたスタイルも確認
                const currentDisplay = window.getComputedStyle(content).display;
                console.log('>>> Current display style:', currentDisplay);
                console.log('>>> Content style.display:', content.style.display);
                
                if (currentDisplay === 'none' || content.style.display === 'none') {
                    content.style.display = 'block';
                    if (arrow) arrow.style.transform = 'rotate(180deg)';
                    console.log('>>> Opened accordion for:', clinicSlug);
                } else {
                    content.style.display = 'none';
                    if (arrow) arrow.style.transform = 'rotate(0deg)';
                    console.log('>>> Closed accordion for:', clinicSlug);
                }
            } else {
                console.error('>>> Content element not found for:', clinicSlug);
            }
        }
       

        // アコーディオンの確認事項を更新
        function updateFirstChoiceDisclaimer(clinicData) {
            const disclaimerHeader = document.getElementById('first-choice-disclaimer-title');
            const disclaimerArrow = document.getElementById('dio-campaign-first-choice-arrow');
            const disclaimerContentDiv = document.getElementById('dio-campaign-first-choice-content');
            const disclaimerButton = disclaimerArrow ? disclaimerArrow.closest('button.disclaimer-header') : null;
            const disclaimerContent = disclaimerContentDiv ? disclaimerContentDiv.querySelector('div') : null;
            
            if (!clinicData) return;
            
            const clinicName = clinicData.name || 'ディオクリニック';
            const clinicCode = clinicData.code || 'dio';
            
            // ヘッダーテキストを更新
            if (disclaimerHeader) {
                disclaimerHeader.textContent = `${clinicName}の確認事項`;
            }
            
            // ボタンのonclick属性/IDは固定のまま。初期状態のみ明示
            if (disclaimerArrow) {
                disclaimerArrow.style.transform = 'rotate(0deg)';
            }
            if (disclaimerContentDiv) {
                disclaimerContentDiv.style.display = 'none';
                disclaimerContentDiv.classList.remove('force-show');
                disclaimerContentDiv.style.visibility = '';
                disclaimerContentDiv.style.opacity = '';
            }
            
            // 確認事項の内容を動的に取得
            const dm2 = window.app?.dataManager || window.dataManager;
            if (dm2 && typeof dm2.getClinicText === 'function' && disclaimerContent) {
                const disclaimerText = dm2.getClinicText(clinicCode, 'INFORMATION確認事項', '');
                if (disclaimerText) {
                    const disclaimerHtml = disclaimerText.split('<br>')
                        .map(text => text.trim())
                        .filter(text => text)
                        .map(text => `<p>${text}</p>`)
                        .join('\n                        ');
                    disclaimerContent.innerHTML = disclaimerHtml;
                }
            }
        }
        
        // クリニックコードから名前を取得するヘルパー関数
        function getClinicNameFromCode(clinicCode) {
            const dm = window.app?.dataManager || window.dataManager;
            if (dm && dm.clinics) {
                const clinic = dm.clinics.find(c => c.code === clinicCode);
                if (clinic) return clinic.name;
            }
            // フォールバック：コードをそのまま返す
            return clinicCode;
        }

        // 動的にクリニック情報を取得（clinic-texts.jsonから）
        function getClinicInfo(clinicSlug) {
            // DataManagerが利用可能な場合は動的に取得
            const dm3 = window.app?.dataManager || window.dataManager;
            if (dm3 && typeof dm3.getClinicText === 'function') {
                const clinicCode = clinicSlug;
                const clinicName = getClinicNameFromCode(clinicCode);
                const regionId = new URLSearchParams(window.location.search).get('region_id') || '013';
                const ctaUrl = window.app && window.app.urlHandler ?
                    window.app.urlHandler.getClinicUrlWithRegionId(clinicData.id) :
                    `https://www.example.com/go/${clinicSlug}/?region_id=${regionId}`;

                return {
                    campaign: clinicInfo['INFORMATIONキャンペーンテキスト'] || '期間限定キャンペーン<br>実施中',
                    achievement: '＼' + (clinicInfo['実績/症例数'] || '実績多数') + '／',
                    ctaUrl: ctaUrl
                };
            }
            
            // フォールバック（DataManagerが利用できない場合）
            const regionId = new URLSearchParams(window.location.search).get('region_id') || '013';
            return {
                campaign: '期間限定キャンペーン<br>実施中',
                achievement: '＼実績多数／',
                ctaUrl: `https://www.example.com/go/${clinicSlug}/?region_id=${regionId}`
            };
        }

        // クリニックURLを取得（CSVデータベースから動的に）
        function getClinicUrl(clinicSlug, rank = 1) {
            // DataManagerから動的に取得
            const dm4 = window.app?.dataManager || window.dataManager;
            if (dm4 && typeof dm4.getClinicText === 'function') {
                const urlKey = `遷移先URL（${rank}位）`;
                const url = dm4.getClinicText(clinicSlug, urlKey, '');
                if (url) {
                    return url;
                }
            }
            // フォールバック（念のため）
            return 'https://sss.ac01.l-ad.net/cl/p1a64143O61e70f7/?bid=a6640dkh37648h88&param2=[ADID_PLACEHOLDER]&param3=[GCLID_PLACEHOLDER]';
        }

        // 3つの理由を設定
        function setThreeReasons(clinicSlug) {
            const pointsContainer = document.getElementById('first-choice-points');
            if (!pointsContainer) return;
            
            // DataManagerを使用して動的にPOINTタイトルと内容を取得
            const dm = window.app?.dataManager || window.dataManager;
            if (!dm) {
                console.error('DataManager not found');
                return;
            }

            const clinicKeyForTexts = slugToNameMap[clinicSlug] || clinicSlug;
            
            // DataManagerを使ってPOINT情報を取得（正しいキーを使用）
            const point1Title = dm.getClinicText(clinicKeyForTexts, 'POINT1タイトル', '');
            const point1Content = dm.getClinicText(clinicKeyForTexts, 'POINT1内容', '');
            const point2Title = dm.getClinicText(clinicKeyForTexts, 'POINT2タイトル', '');
            const point2Content = dm.getClinicText(clinicKeyForTexts, 'POINT2内容', '');
            const point3Title = dm.getClinicText(clinicKeyForTexts, 'POINT3タイトル', '');
            const point3Content = dm.getClinicText(clinicKeyForTexts, 'POINT3内容', '');
            
            
            const reasons = [
                {
                    title: point1Title,
                    description: point1Content
                },
                {
                    title: point2Title,
                    description: point2Content
                },
                {
                    title: point3Title,
                    description: point3Content
                }
            ];
            
            const officialUrl = `https://www.xn--ecki4eoz3204ct89aepry34c.com/go/${clinicSlug}/?max_scroll=100&region_id=013`;
            
            let html = '';
            reasons.forEach(reason => {
                html += `
                    <div class="ribbon_point_title2_s">
                        <i class="fas fa-clock point-icon-inline"></i>
                        <strong>${dm.processDecoTags ? dm.processDecoTags(reason.title) : reason.title}</strong>
                    </div>
                    <div class="ribbon_point_txt">
                        <p style="font-size:14px;">${dm.processDecoTags ? dm.processDecoTags(reason.description) : reason.description}</p>
                    </div>
                `;
            });
            
            // 公式リンクも更新
            const officialLink = document.getElementById('first-choice-official-link');
            if (officialLink) {
                const clinicUrl = dm.getClinicText(clinicKeyForTexts, '公式サイトURL', 'https://omt.jp/');
                officialLink.innerHTML = `【公式】<a href="${officialUrl}" target="_blank" rel="noopener"><strong>${clinicUrl}</strong></a>`;
            }
            
            pointsContainer.innerHTML = html + (pointsContainer.innerHTML.match(/<div class="ribbon_point_link"[\s\S]*?<\/div>/)?.[0] || '');
        }

        // CASEセクションを設定（1位クリニックの症例写真を表示）
        function setCaseSection(clinicSlug) {
            try {
                // 既存のCASEセクションがあれば削除して入れ替え
                const existingCase = document.querySelector('.case-section-container');
                if (existingCase) existingCase.remove();

                // 画像定義（クリニックコード別）
                const dynamicCaseImages = {
                    // ディオクリニック（例）
                    dio: [
                        { fallbacks: ['images/dio_case01.jpg'], alt: 'CASE 01' },
                        { fallbacks: ['images/dio_case02.jpg'], alt: 'CASE 02' },
                        { fallbacks: ['images/dio_case03.jpg'], alt: 'CASE 03' }
                    ],
                    // TCB（ユーザー追加画像）
                    tcb: [
                        { fallbacks: ['images/tcb_case01.jpg'], alt: 'CASE 01' },
                        { fallbacks: ['images/tcb_case02.jpg'], alt: 'CASE 02' },
                        { fallbacks: ['images/tcb_case03.jpg'], alt: 'CASE 03' }
                    ]
                };

                const imagesForClinic = dynamicCaseImages[clinicSlug];
                if (!imagesForClinic || !imagesForClinic.length) {
                    // 対応画像がない場合は何もしない
                    return;
                }

                const sectionAnchor = document.querySelector('#first-choice-recommendation-section .first-choice-recommendation-section');
                if (!sectionAnchor) return;

                const container = document.createElement('div');
                container.className = 'case-section-container';
                container.innerHTML = `
                    <div class="clinic-points-section" style="margin-top: 14px;">
                        <h4 class="section-title">症例写真</h4>
                        <div class="case-slider" style="position: relative; overflow: hidden;">
                            <div class="case-track" style="display:flex;">
                                ${imagesForClinic.map((img, idx) => `
                                    <div class="case-slide" style="min-width:100%;box-sizing:border-box;">
                                        <img src="${img.fallbacks[0]}" alt="${img.alt}" loading="lazy" style="width:100%;height:auto;object-fit:contain;">
                                        <div class="case-info" style="margin-top: 5px; padding: 0 5%; text-align: left; font-size: 12px; line-height: 1.6; width: 100%;">
                                            <table class="case-table" style="width: 100% !important; border-collapse: collapse !important; font-size: 8px !important; line-height: 1.6 !important; display: table !important; table-layout: fixed !important;">
                                                <tbody>
                                                    <tr>
                                                        <td style="padding: 0 8px !important; background-color: #f8f8f8 !important; font-weight: bold !important; width: 30% !important;">コース名</td>
                                                        <td style="padding: 0 8px !important;">—</td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 0 8px !important; background-color: #f8f8f8 !important; font-weight: bold !important;">施術の説明</td>
                                                        <td style="padding: 0 8px !important;">—</td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 0 8px !important; background-color: #f8f8f8 !important; font-weight: bold !important;">副作用<br>（リスク）</td>
                                                        <td style="padding: 0 8px !important; color: #666 !important;">—</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="case-nav case-nav-prev" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.8);border:none;border-radius:50%;width:40px;height:40px;font-size:20px;cursor:pointer;z-index:10;">‹</button>
                            <button class="case-nav case-nav-next" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.8);border:none;border-radius:50%;width:40px;height:40px;font-size:20px;cursor:pointer;z-index:10;">›</button>
                        </div>
                        <div class="case-dots" style="text-align:center;margin-top:10px;">
                            ${imagesForClinic.map((_, i) => `<button class="case-dot ${i===0?'active':''}" data-index="${i}" style="width:8px;height:8px;border-radius:50%;border:none;background:${i===0?'#2CC7C5':'#ccc'};margin:0 4px;cursor:pointer;"></button>`).join('')}
                        </div>
                    </div>
                `;

                sectionAnchor.appendChild(container);

                // フォールバックとCSV/JSONからのテキスト差し替え
                try {
                    const dm = window.app?.dataManager || window.dataManager;
                    const root = container;
                    const caseSection = root.querySelector('.case-slider')?.closest('.clinic-points-section');

                    // 画像 onerror で非表示
                    let hadError = false;
                    root.querySelectorAll('.case-slider img').forEach((img) => {
                        img.onerror = () => { hadError = true; if (caseSection) caseSection.style.display = 'none'; };
                    });

                    // 症例テキスト差し替え（存在すれば）
                    if (dm && typeof dm.getClinicText === 'function' && caseSection) {
                        const slides = root.querySelectorAll('.case-slider .case-slide');
                        slides.forEach((slide, sIdx) => {
                            const rows = slide.querySelectorAll('table.case-table tbody tr');
                            const keyBase = `case${sIdx + 1}`;
                            const nameVal = dm.getClinicText(clinicSlug, `${keyBase}コース名`, '') || (rows[0]?.children?.[1]?.textContent || '');
                            const descVal = dm.getClinicText(clinicSlug, `${keyBase}施術の説明`, '') || (rows[1]?.children?.[1]?.textContent || '');
                            const riskVal = dm.getClinicText(clinicSlug, `${keyBase}副作用（リスク）`, '') || (rows[2]?.children?.[1]?.textContent || '');
                            if (rows[0]?.children?.[1]) rows[0].children[1].textContent = nameVal;
                            if (rows[1]?.children?.[1]) rows[1].children[1].textContent = descVal;
                            if (rows[2]?.children?.[1]) rows[2].children[1].textContent = riskVal;
                        });
                    }
                } catch (e) { /* no-op */ }

                // シンプルスライダー初期化
                try {
                    const track = container.querySelector('.case-track');
                    const slides = container.querySelectorAll('.case-slide');
                    const dots = container.querySelectorAll('.case-dot');
                    const prevBtn = container.querySelector('.case-nav-prev');
                    const nextBtn = container.querySelector('.case-nav-next');
                    if (track && slides.length) {
                        let current = 0;
                        function show(i){
                            if (i<0) i = slides.length-1;
                            if (i>=slides.length) i = 0;
                            current = i;
                            track.style.display = 'flex';
                            track.style.transform = `translateX(-${current*100}%)`;
                            track.style.transition = 'transform .3s ease';
                            slides.forEach(s=>{ s.style.minWidth='100%'; s.style.boxSizing='border-box'; });
                            dots.forEach((d,idx)=>{ d.classList.toggle('active', idx===current); d.style.background = idx===current ? '#2CC7C5' : '#ccc'; });
                        }
                        prevBtn && prevBtn.addEventListener('click', ()=>show(current-1));
                        nextBtn && nextBtn.addEventListener('click', ()=>show(current+1));
                        dots.forEach((d,idx)=> d.addEventListener('click', ()=>show(idx)));
                        show(0);
                    }
                } catch(e) { /* no-op */ }
            } catch (e) {
                // 失敗時は静かにスキップ
            }
        }

        // 1位クリニックの表示内容設定（症例セクション含む）
        function setFirstChoiceClinic(clinicData) {
            if (!clinicData) return;
            try {
                const clinicName = clinicData.name || '';
                const clinicCode = clinicData.code || (window.dataManager ? (window.dataManager.getClinicCodeById ? window.dataManager.getClinicCodeById(clinicData.id) : '') : '');

                // タイトル内のクリニック名を更新
                const nameSpans = [
                    document.getElementById('first-choice-clinic-name'),
                    document.getElementById('first-choice-title-clinic-name')
                ];
                nameSpans.forEach(span => { if (span) span.textContent = clinicName; });

                // 3つの理由テキスト
                if (clinicCode) {
                    try { setThreeReasons(clinicCode); } catch (e) {}
                }

                // 確認事項の文面
                try { updateFirstChoiceDisclaimer({ name: clinicName, code: clinicCode }); } catch (e) {}

                // 症例セクションは案件詳細内で実装するため、ここでは挿入しない
            } catch (e) { /* no-op */ }
        }


        // 1位クリニック情報の更新を実行
        function updateFirstChoiceClinic() {
            if (!window.app || !window.app.dataManager) {
                return;
            }
            
            // 現在の地域IDを取得
            const regionId = window.app.urlHandler ? window.app.urlHandler.getRegionId() : '013';
            
            // ランキングデータを取得
            const ranking = window.app.dataManager.getRankingByRegionId(regionId);
            
            if (!ranking || !ranking.ranks) {
                console.log('No ranking data found for region:', regionId);
                return;
            }
            
            // 1位のクリニックIDを取得
            const firstPlaceClinicId = ranking.ranks.no1;
            
            if (!firstPlaceClinicId) {
                console.log('No first place clinic found');
                return;
            }
            
            // クリニック情報を取得
            const allClinics = window.app.dataManager.getAllClinics();
            const firstClinic = allClinics.find(clinic => clinic.id === firstPlaceClinicId);
            
            if (firstClinic) {
                setFirstChoiceClinic(firstClinic);
            }
        }

        // 初期化時に実行
        document.addEventListener('DOMContentLoaded', function() {
            // 動的マッピング生成後にクリニック更新を実行
            generateDynamicMappingsAsync();
        });

        // app.jsが読み込まれた後にも実行（タイマーで複数回試行）
        let retryCount = 0;
        const maxRetries = 10;
        
        function tryUpdateFirstChoice() {
            if (window.app && window.app.dataManager && window.app.dataManager.getAllClinics().length > 0) {
                updateFirstChoiceClinic();
                return;
            }
            
            retryCount++;
            if (retryCount < maxRetries) {
                // console.log(`App not ready yet, retry ${retryCount}/${maxRetries}`);
                setTimeout(tryUpdateFirstChoice, 500);
            } else {
                // console.log('Max retries reached, app may not be loaded');
            }
        }
        
        // 少し遅延してから開始
        setTimeout(tryUpdateFirstChoice, 100);

        // 地域変更時のイベントリスナーも追加
        function setupRegionChangeWatcher() {
            if (!window.app || !window.app.urlHandler) {
                setTimeout(setupRegionChangeWatcher, 500);
                return;
            }
            
            let currentRegionId = window.app.urlHandler.getRegionId();
            
            // URLパラメータ変更の監視
            setInterval(() => {
                const newRegionId = window.app.urlHandler ? window.app.urlHandler.getRegionId() : '013';
                if (newRegionId !== currentRegionId) {
                    currentRegionId = newRegionId;
                    console.log('Region changed to:', newRegionId);
                    setTimeout(() => updateFirstChoiceClinic(), 100); // 少し遅延を入れる
                }
            }, 1000);
        }
        
        // 地域監視を開始
        setupRegionChangeWatcher();
        
        // ページ読み込み完了時にもう一度実行
        window.addEventListener('load', function() {
            setTimeout(() => updateFirstChoiceClinic(), 1000);
        });
    </script>

    <script>
        // 比較表のタブ切り替え機能
        // 全てのパラメータを引き継ぐ共通処理
        function preserveAllParams() {
            const currentParams = new URLSearchParams(window.location.search);
            if (currentParams.toString()) {
                // すべての内部リンクにパラメータを追加
                const links = document.querySelectorAll('a[href^="/"], a[href^="./"], a[href^="../"], a[href]:not([href^="http"]):not([href^="#"])');
                links.forEach(link => {
                    try {
                        const url = new URL(link.href, window.location.origin);
                        // 既存のパラメータを保持しつつ、現在のパラメータを追加
                        for (const [key, value] of currentParams) {
                            if (!url.searchParams.has(key)) {
                                url.searchParams.set(key, value);
                            }
                        }
                        link.href = url.toString();
                    } catch (e) {
                        // 相対URLの場合
                        const separator = link.href.includes('?') ? '&' : '?';
                        link.href = link.href + separator + currentParams.toString();
                    }
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // パラメータを引き継ぐ
            preserveAllParams();
            
            const tabMenuItems = document.querySelectorAll('.comparison-tab-menu-item');
            const table = document.querySelector('.comparison-table table');
            
            function updateTableColumns(tabType) {
                if (!table) return;
                
                const tableContainer = document.querySelector('.comparison-table');
                const headers = table.querySelectorAll('th');
                const rows = table.querySelectorAll('tbody tr');
                
                // タブごとの表示列インデックス（実際のHTMLの列番号に合わせて修正）
                const tabColumnsMap = {
                    'tab1': [0, 1, 2, 3, 10], // 総合: クリニック名, 総合評価, 費用, 特徴, 公式サイトURL
                    'tab2': [0, 4, 5, 6, 10], // 施術内容: クリニック名, 矯正範囲, 目安期間, 通院頻度, 公式サイトURL
                    'tab3': [0, 7, 8, 9, 10]  // サービス: クリニック名, 実績/症例数, ワイヤー矯正の紹介, サポート, 公式サイトURL
                };
                
                const showIndexes = tabColumnsMap[tabType] || tabColumnsMap['tab1'];
                
                // コンテナにアクティブなタブを設定
                tableContainer.setAttribute('data-active-tab', tabType);
                
                // タブに応じて動的にヘッダーテキストを更新（JSONファイルから取得）
                const headerConfig = window.dataManager ? window.dataManager.getClinicHeaderConfig() : null;
                
                const headerTextMap = {
                    'tab1': [
                        headerConfig && headerConfig['比較表ヘッダー1'] || 'クリニック', 
                        headerConfig && headerConfig['比較表ヘッダー2'] || '総合評価',
                        headerConfig && headerConfig['比較表ヘッダー3'] || '費用',
                        headerConfig && headerConfig['比較表ヘッダー4'] || '特徴',
                        headerConfig && headerConfig['比較表ヘッダー11'] || '公式サイト'
                    ],
                    'tab2': [
                        headerConfig && headerConfig['比較表ヘッダー1'] || 'クリニック', 
                        headerConfig && headerConfig['比較表ヘッダー5'] || '矯正範囲',
                        headerConfig && headerConfig['比較表ヘッダー6'] || '目安期間',
                        headerConfig && headerConfig['比較表ヘッダー7'] || '通院頻度',
                        headerConfig && headerConfig['比較表ヘッダー11'] || '公式サイト'
                    ], 
                    'tab3': [
                        headerConfig && headerConfig['比較表ヘッダー1'] || 'クリニック', 
                        headerConfig && headerConfig['比較表ヘッダー8'] || '実績/症例数',
                        headerConfig && headerConfig['比較表ヘッダー9'] || 'ワイヤー矯正の紹介',
                        headerConfig && headerConfig['比較表ヘッダー10'] || 'サポート',
                        headerConfig && headerConfig['比較表ヘッダー11'] || '公式サイト'
                    ]
                };
                
                const currentHeaderTexts = headerTextMap[tabType] || headerTextMap['tab1'];
                
                // requestAnimationFrameを使用して最適化
                requestAnimationFrame(() => {
                    // 表示される列のヘッダーテキストを動的に更新
                    let headerTextIndex = 0;
                    headers.forEach((th, index) => {
                        if (showIndexes.includes(index)) {
                            if (headerTextIndex < currentHeaderTexts.length) {
                                th.textContent = currentHeaderTexts[headerTextIndex];
                                headerTextIndex++;
                            }
                        }
                    });
                    
                    // ヘッダーの表示/非表示
                    headers.forEach((th, index) => {
                        if (showIndexes.includes(index)) {
                            // 表示する列: すべてのインラインスタイルを削除
                            th.removeAttribute('style');
                            th.classList.remove('th-none');
                            th.classList.remove('td-none');
                        } else {
                            // 非表示の列
                            th.style.display = 'none';
                            th.style.visibility = 'hidden';
                            th.style.width = '0';
                            th.style.padding = '0';
                            th.style.border = '0';
                            th.classList.add('th-none');
                        }
                    });
                    
                    // 各行のセルの表示/非表示
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        cells.forEach((td, index) => {
                            if (showIndexes.includes(index)) {
                                // 表示する列: すべてのインラインスタイルを削除
                                td.removeAttribute('style');
                                td.classList.remove('th-none');
                                td.classList.remove('td-none');
                            } else {
                                // 非表示の列
                                td.style.display = 'none';
                                td.style.visibility = 'hidden';
                                td.style.width = '0';
                                td.style.padding = '0';
                                td.style.border = '0';
                                td.classList.add('td-none');
                            }
                        });
                    });
                });
            }
            
            tabMenuItems.forEach(item => {
                item.addEventListener('click', function() {
                    // すべてのタブを非アクティブに
                    tabMenuItems.forEach(tab => tab.classList.remove('tab-active'));
                    // クリックしたタブをアクティブに
                    this.classList.add('tab-active');

                    // タブに応じて表示列を切り替え
                    const tabType = this.getAttribute('data-tab');
                    updateTableColumns(tabType);
                });
            });
            
            // 初期表示
            updateTableColumns('tab1');
            
        });

        // アコーディオン機能（2段階）
        // この関数は958行目で既に定義されているため、ここでの再定義は削除
        // window.toggleMainDisclaimer関数は958行目の実装を使用
        
        window.toggleDisclaimer = function(clinicId) {
            console.log('>>> toggleDisclaimer called:', clinicId);
            
            // 特別な処理: dio-campaign-first-choiceの場合
            if (clinicId === 'dio-campaign-first-choice') {
                // シンプルなトグル処理
                const content = document.getElementById('dio-campaign-first-choice-content');
                const arrow = document.getElementById('dio-campaign-first-choice-arrow');
                
                if (content && arrow) {
                    if (content.style.display === 'none' || !content.style.display) {
                        content.style.display = 'block';
                        arrow.style.transform = 'rotate(180deg)';
                    } else {
                        content.style.display = 'none';
                        arrow.style.transform = 'rotate(0deg)';
                    }
                    return; // 処理完了
                }
                
                // 元の複雑な処理に続く
                const contentOriginal = document.getElementById('dio-campaign-first-choice-content');
                const arrowOriginal = document.getElementById('dio-campaign-first-choice-arrow');
                
                if (!(content && arrow)) {
                    // フォールバック: 比較表下の第二段階（idが 'dio-content' / 'dio-arrow'）に対応
                    const baseCode = (clinicId.split('-')[0] || 'dio');
                    const fbContent = document.getElementById(baseCode + '-content');
                    const fbArrow = document.getElementById(baseCode + '-arrow');
                    if (fbContent && fbArrow) {
                        const isHidden = window.getComputedStyle(fbContent).display === 'none';
                        if (isHidden) {
                            fbContent.style.display = 'block';
                            fbArrow.style.transform = 'rotate(180deg)';
                            console.log('→ Fallback general accordion opened:', baseCode);
                        } else {
                            fbContent.style.display = 'none';
                            fbArrow.style.transform = 'rotate(0deg)';
                            console.log('→ Fallback general accordion closed:', baseCode);
                        }
                        return; // フォールバックで処理完了
                    }
                }

                if (content && arrow) {
                    // 常に所定位置へ退避（念のため）
                    try {
                        const mainContent = document.getElementById('main-content');
                        const accordion = content.closest('.disclaimer-accordion');
                        const containerAnchor = document.getElementById('first-choice-recommendation-section');
                        const sectionAnchor = document.querySelector('#first-choice-recommendation-section .first-choice-recommendation-section');
                        const targetAnchor = sectionAnchor || containerAnchor;
                        const isInMain = (() => {
                            let n = accordion;
                            while (n && n !== document.body) { if (n.id === 'main-content') return true; n = n.parentElement; }
                            return false;
                        })();
                        const needsMove = targetAnchor && accordion && accordion.parentElement !== targetAnchor;
                        console.log('Relocation check:', { hasAnchor: !!targetAnchor, isInMain, needsMove });
                        if (needsMove) {
                            targetAnchor.appendChild(accordion);
                            console.log('Relocated first-choice accordion under .first-choice-recommendation-section');
                        }
                    } catch (e) { console.warn('Relocation error:', e); }

                    const computed = window.getComputedStyle(content);
                    const currentDisplay = computed.display;
                    console.log('First choice accordion - current display:', currentDisplay, '| visibility:', computed.visibility, '| opacity:', computed.opacity);
                    
                    const accordion = content.closest('.disclaimer-accordion');
                    const section = content.closest('section');
                    const ancestors = [];
                    let node = content.parentElement;
                    while (node && node !== document.body) {
                        const cs = window.getComputedStyle(node);
                        const isHidden = cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0' || cs.maxHeight === '0px' || cs.height === '0px';
                        if (isHidden) {
                            const info = { tag: node.tagName, cls: node.className, id: node.id, display: cs.display, visibility: cs.visibility, opacity: cs.opacity, height: cs.height, maxHeight: cs.maxHeight };
                            ancestors.push(info);
                            // 一時的に可視化
                            node.classList.add('force-ancestor-show');
                            if (node.classList.contains('hidden')) {
                                node.classList.remove('hidden');
                                node.setAttribute('data-removed-hidden', '1');
                            }
                            if (node.hasAttribute('hidden')) {
                                node.removeAttribute('hidden');
                                node.setAttribute('data-removed-hidden-attr', '1');
                            }
                            if (node.getAttribute('aria-hidden') === 'true') {
                                node.setAttribute('aria-hidden', 'false');
                                node.setAttribute('data-changed-aria-hidden', '1');
                            }
                        }
                        node = node.parentElement;
                    }
                    if (ancestors.length) {
                        try {
                            console.log('Ancestors with potential hidden styles (text):\n' + JSON.stringify(ancestors, null, 2));
                        } catch (e) {
                            console.log('Ancestors with potential hidden styles:', ancestors);
                        }
                    }
                    
                    if (currentDisplay === 'none') {
                        // 表示 - 強制的に見える状態へ
                        if (accordion) {
                            accordion.style.display = 'block';
                            accordion.style.visibility = 'visible';
                            accordion.style.opacity = '1';
                            accordion.style.position = 'relative';
                            accordion.style.zIndex = '9999';
                        }
                        if (section) {
                            section.style.display = section.style.display || 'block';
                        }
                        content.classList.add('force-show');
                        content.style.display = 'block';
                        content.style.visibility = 'visible';
                        content.style.opacity = '1';
                        content.style.maxHeight = 'none';
                        content.style.height = 'auto';
                        arrow.style.transform = 'rotate(180deg)';
                        console.log('→ First choice accordion opened (applied force-show + inline styles)');
                        try {
                            const rect = content.getBoundingClientRect();
                            console.log('First choice content rect after open:', { top: rect.top, left: rect.left, width: rect.width, height: rect.height });
                        } catch (e) {}
                        
                        // main-disclaimer-contentが親要素として影響している場合の対処
                        const mainContent = document.getElementById('main-content');
                        if (mainContent && window.getComputedStyle(mainContent).display === 'none') {
                            const acc = content.closest('.disclaimer-accordion');
                            const sectionAnchor = document.querySelector('#first-choice-recommendation-section .first-choice-recommendation-section');
                            if (acc && mainContent.contains(acc)) {
                                if (sectionAnchor) {
                                    sectionAnchor.appendChild(acc);
                                    console.log('Relocated first-choice accordion (during open) under .first-choice-recommendation-section');
                                } else {
                                    mainContent.parentNode.insertBefore(acc, mainContent.nextSibling);
                                    console.log('Relocated first-choice accordion (during open) outside main-content');
                                }
                            }
                        }
                        
                        // スクロールして表示を確認（ヘッダー分オフセット）
                        try {
                            const doScroll = () => {
                                const rect2 = content.getBoundingClientRect();
                                const targetTop = rect2.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop) - 80;
                                window.scrollTo({ top: targetTop, behavior: 'auto' });
                                setTimeout(() => {
                                    const rect3 = content.getBoundingClientRect();
                                    console.log('After scroll check:', { pageYOffset: window.pageYOffset, rectTop: rect3.top, rectHeight: rect3.height });
                                    // まだ見えていなければもう一度
                                    if (rect3.top < -10 || rect3.top > window.innerHeight) {
                                        const targetTop2 = rect3.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop) - 80;
                                        window.scrollTo({ top: targetTop2, behavior: 'auto' });
                                    }
                                }, 120);
                            };
                            doScroll();
                        } catch (e) {}
                    } else {
                        // 非表示 - 強制表示状態を解除
                        content.classList.remove('force-show');
                        content.style.display = 'none';
                        content.style.visibility = '';
                        content.style.opacity = '';
                        content.style.maxHeight = '';
                        content.style.height = '';
                        arrow.style.transform = 'rotate(0deg)';
                        console.log('→ First choice accordion closed');
                        try {
                            const rect = content.getBoundingClientRect();
                            console.log('First choice content rect after close:', { top: rect.top, left: rect.left, width: rect.width, height: rect.height });
                        } catch (e) {}
                        // 祖先の上書きクラスを外す
                        let n = content.parentElement;
                        while (n && n !== document.body) {
                            if (n.classList.contains('force-ancestor-show')) {
                                n.classList.remove('force-ancestor-show');
                                if (n.getAttribute('data-removed-hidden') === '1') {
                                    n.classList.add('hidden');
                                    n.removeAttribute('data-removed-hidden');
                                }
                                if (n.getAttribute('data-removed-hidden-attr') === '1') {
                                    n.setAttribute('hidden', '');
                                    n.removeAttribute('data-removed-hidden-attr');
                                }
                                if (n.getAttribute('data-changed-aria-hidden') === '1') {
                                    n.setAttribute('aria-hidden', 'true');
                                    n.removeAttribute('data-changed-aria-hidden');
                                }
                            }
                            n = n.parentElement;
                        }
                    }
                } else {
                    console.warn('First choice elements not found:', { hasContent: !!content, hasArrow: !!arrow });
                }
                return; // 特別処理終了
            }
            
            // 通常のアコーディオン処理（祖先可視化と詳細ログ付き）
            const contentId = clinicId + '-content';
            const arrowId = clinicId + '-arrow';
            
            const content = document.getElementById(contentId);
            const arrow = document.getElementById(arrowId);
            
            console.log('Looking for:', contentId, '→', content ? 'FOUND' : 'NOT FOUND');
            console.log('Looking for:', arrowId, '→', arrow ? 'FOUND' : 'NOT FOUND');
            
            if (content && arrow) {
                const computed = window.getComputedStyle(content);
                const currentDisplay = computed.display;
                if (currentDisplay === 'none') {
                    // 祖先の非表示を検出し、一時的に可視化
                    const ancestors = [];
                    let node = content.parentElement;
                    while (node && node !== document.body) {
                        const cs = window.getComputedStyle(node);
                        const isHidden = cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0' || cs.maxHeight === '0px' || cs.height === '0px';
                        if (isHidden) {
                            const info = { tag: node.tagName, cls: node.className, id: node.id, display: cs.display, visibility: cs.visibility, opacity: cs.opacity, height: cs.height, maxHeight: cs.maxHeight };
                            ancestors.push(info);
                            node.classList.add('force-ancestor-show');
                            if (node.classList.contains('hidden')) {
                                node.classList.remove('hidden');
                                node.setAttribute('data-removed-hidden', '1');
                            }
                            if (node.hasAttribute('hidden')) {
                                node.removeAttribute('hidden');
                                node.setAttribute('data-removed-hidden-attr', '1');
                            }
                            if (node.getAttribute('aria-hidden') === 'true') {
                                node.setAttribute('aria-hidden', 'false');
                                node.setAttribute('data-changed-aria-hidden', '1');
                            }
                        }
                        node = node.parentElement;
                    }
                    if (ancestors.length) {
                        try { console.log('Ancestors (general) with potential hidden styles (text):\n' + JSON.stringify(ancestors, null, 2)); } catch (e) { console.log('Ancestors (general):', ancestors); }
                    }
                    
                    // 表示
                    content.style.display = 'block';
                    content.style.visibility = 'visible';
                    content.style.opacity = '1';
                    arrow.style.transform = 'rotate(180deg)';
                    console.log('→ General accordion opened:', clinicId);
                    try {
                        const rect = content.getBoundingClientRect();
                        console.log('General content rect after open:', { top: rect.top, left: rect.left, width: rect.width, height: rect.height });
                        const doScroll = () => {
                            const r2 = content.getBoundingClientRect();
                            const targetTop = r2.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop) - 80;
                            window.scrollTo({ top: targetTop, behavior: 'auto' });
                            setTimeout(() => {
                                const r3 = content.getBoundingClientRect();
                                console.log('After scroll check (general):', { pageYOffset: window.pageYOffset, rectTop: r3.top, rectHeight: r3.height });
                            }, 120);
                        };
                        doScroll();
                    } catch (e) {}
                } else {
                    // 非表示（クリーンアップ含む）
                    content.style.display = 'none';
                    content.style.visibility = '';
                    content.style.opacity = '';
                    arrow.style.transform = 'rotate(0deg)';
                    console.log('→ General accordion closed:', clinicId);
                    // 祖先の上書きクラスを外す
                    let n = content.parentElement;
                    while (n && n !== document.body) {
                        if (n.classList.contains('force-ancestor-show')) {
                            n.classList.remove('force-ancestor-show');
                            if (n.getAttribute('data-removed-hidden') === '1') {
                                n.classList.add('hidden');
                                n.removeAttribute('data-removed-hidden');
                            }
                            if (n.getAttribute('data-removed-hidden-attr') === '1') {
                                n.setAttribute('hidden', '');
                                n.removeAttribute('data-removed-hidden-attr');
                            }
                            if (n.getAttribute('data-changed-aria-hidden') === '1') {
                                n.setAttribute('aria-hidden', 'true');
                                n.removeAttribute('data-changed-aria-hidden');
                            }
                        }
                        n = n.parentElement;
                    }
                }
            }
        }

        // ディオクリニックの確認事項ボタンに直接イベントリスナーを設定
        // クリックイベントは既にHTML内のonclick属性で設定済みなので、追加の設定は不要
        // 二重にイベントが発生しないよう、この部分は削除
        
        // Add click animation to links
        document.querySelectorAll('.medical-columns-section .toc-link, .medical-columns-section .contact-link').forEach(link => {
            link.addEventListener('click', function(e) {
                // contact-linkの場合は外部リンクなので、アニメーションのみ実行
                this.style.opacity = '0.7';
                setTimeout(() => {
                    this.style.opacity = '1';
                }, 150);
                
                // toc-linkの場合のみスムーズスクロールを実行
                if (this.classList.contains('toc-link') && this.getAttribute('href').startsWith('#')) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            });
        });

        // Tips Section Tab Functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for disclaimer accordions
            const rankingBtn = document.getElementById('ranking-disclaimer-button');
            if (rankingBtn) {
                rankingBtn.addEventListener('click', window.toggleRankingDisclaimer);
            }

            const comparisonBtn = document.getElementById('comparison-disclaimer-button');
            if (comparisonBtn) {
                comparisonBtn.addEventListener('click', window.toggleComparisonDisclaimer);
            }

            const tabs = document.querySelectorAll('.tips-container .tab');
            const tabContents = document.querySelectorAll('.tips-container .tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabIndex = this.getAttribute('data-tab');
                    
                    // Update tab styles
                    tabs.forEach(t => {
                        t.style.backgroundColor = '#F1F1F1';
                        t.style.color = '#4C4C4C';
                    });
                    this.style.backgroundColor = '#2CC7C5';
                    this.style.color = 'white';
                    
                    // Show/hide content
                    tabContents.forEach(content => {
                        if (content.getAttribute('data-tab') === tabIndex) {
                            content.style.display = 'block';
                        } else {
                            content.style.display = 'none';
                        }
                    });
                });
            });
        });
    </script>
    
    <!-- Clinic URLs are now managed dynamically from CSV database -->
    
    <!-- URL Parameter Tracking -->
    <script src="/url-tracking.js?v=2025072201" defer></script>
    
    <!-- Service Worker登録 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {})
                    .catch(err => {});
            });
        }
    </script>
    
    <!-- Load common site data -->
    <script>
        // Load common site data
        fetch('../../../common_data/data/site-common-texts.json')
            .then(response => response.json())
            .then(data => {
                // Update site logo
                const siteLogo = document.getElementById('site-logo');
                if (siteLogo && data.サイト名) {
                    siteLogo.textContent = data.サイト名;
                }

                // Update favicon
                const favicon = document.getElementById('header-logo-icon');
                if (favicon && data.ファビコン画像パス) {
                    favicon.src = data.ファビコン画像パス;
                }

                // Update footer site name (copyright text contains both site name and copyright)
                const footerSiteName = document.querySelector('.copyright');
                if (footerSiteName && data.サイト名) {
                    footerSiteName.textContent = '© 2025 ' + data.サイト名;
                }
                
            })
            .catch(error => {
                console.error('Error loading common site data:', error);
            });
    </script>
    <script src="/tracking-params.js"></script>
</body>
</html>